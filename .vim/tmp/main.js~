  /////////////////
 // DRIVER CODE //
/////////////////
$(document).ready(function () {
    var page_name = location.pathname.substring(1).toLowerCase();

    // disable dashboard for lt-ie8 users
    if (page_name === 'dashboard.aspx' && $('html').hasClass('lt-ie8')) {
        // browser detection with messaging
        var lt_ie8_template =
            '<div id="xp_ie7_message">' +
                '<p><h3>SHP<i>Solutions</i>&trade; DASHBOARD</h3>This feature is currently only available for IE8+<br />' +
                '<a href="http://www.microsoft.com/en-us/download/details.aspx?id=43" target="_blank">Click Here for Instructions to Upgrade Your Browser</a></p>' +
            '</div>';

        $('body').prepend(lt_ie8_template);

    } else {

        if ($('html').hasClass('lt-ie8')) {

            var ltIe8Message =
                '<div id="lt_ie9_message" class="messages red_msg">' +
                    '<b class="red">Warning:</b> <i>You are using a discontinued version of Internet Explorer. It is critical to upgrade to the latest version to resolve security and functionality problems. <a href="http://www.microsoft.com/en-us/download/details.aspx?id=43" target="_blank">Click here</a> to upgrade.</i>' +
                '</div>';

            $('#UserMessage_shp_emergency_msg').parent().prepend(ltIe8Message);
        }

        // load tab functions and events: js/shp-ui-tabs.js
        $.dashboard_tabs();

        // hide the li element that contains the admin link if user is not an admin
        $('.text_links').each(function () {
            if (!$(this).html()) {
                $(this).hide();
            }
        });

        $('#header a#admin').click(function () {
            $('#shp_emergency_msg').toggleClass('none');
        });

        // init button
        $('button, .button_update, input[type="submit"]:not(.icon_only,.sprite)').button();

        // the above technique will need to be implemented for views below...
        $('.view_splitter').each(function () {
            $(this).width(770).height(410).split({ orientation: 'vertical', limit: 10 });
        });

        // load accordion functions and events: js/shp-ui-accordion.js
        // and tooltip plugin for all elements of the .tooltip class
        $('#accordion').accordion_sidenav().sidenav_tooltip();

        // load slimtab functions and events: js/portal-slimtab.js
        $(document).slimtab();

        // basic jQueryUI tooltips
        $('.tt').tooltip({"show": {duration: 100}});

        // title bar icon tooltips
        $('#header_config a').tooltip({
            tooltipClass: 'settings-bar',
            position: { 
                my: "left top+15",
                at: "right-35 bottom",
                    using: function(position, feedback) {
                        $(this).css(position);
                        $('<div class="arrow"><img width="40" height="22" src="/usercontrols/images/settings-tooltip-arrow.png" /></div>')
                            .addClass(feedback.vertical)
                            .addClass(feedback.horizontal)
                            .appendTo(this);
                    }
                },
            "show": { duration: 100 },
            "hide": { duration: 200 }
        });

        // DASHBOAD ONLY
        if (page_name === 'dashboard.aspx') {

            $.ui_widget();

            // add widget dialog
            $.create_add_widget_div();

            // coming soon widgets tab
            $(document).ComingSoon();

            // configure widget dialog
            $(document).config_widget_dialog();
            // add view dialog
            $('#add_view_dialog').add_view_dialog({
                open_link_id: '#create_new_view'
            }).filterViews();

            // configure view dialog
            $('#config_view_dialog').config_view_dialog();
            // save view dialog
            $('#save_view_dialog').save_view_dialog();

            // shared views
            $('#shared_view_list').SharedViews();

            $(document).PrintDashboard();

            // APPEND HELPER CLASSES ---------------------------
            $('span.close_icon').addClass('icon-only ui-icon ui-icon-close');
            $('ul.icons').addClass('ui-widget');
            $('ul.icons li').addClass('ui-state-default ui-corner-all');
            $('.icons > div').addClass('ui-state-default ui-corner-all');
            $('.widget_close').addClass('ui-icon ui-icon-close');
            $('.widget_config').addClass('ui-icon ui-icon-wrench');
            $('.grow_tall').addClass('ui-icon-arrow-2-n-s ui-icon');
            $('.grow_wide').addClass('ui-icon-arrow-2-e-w ui-icon');
            $('#tabs ul').removeClass('ui-helper-clearfix');
        }

        // modal dialog for settings page
        $(document).settings_dialog();

        // modal dialog for confirming delete of widget
        $(document).confirm_dialog();
        // modal dialog for confirming delete of widget
        $(document).confirm_share_dialog();
        $(document).confirm_share_delete();

        // the tabular class depends on the below appended classes
        $('tr:nth-child(even), td:nth-child(even)').addClass('even');
        $('tr:last-child, td:last-child').addClass('last');
        $('tr:first-child, td:first-child').addClass('first');

        // cache buttons
        var shp_buttons = $('input[type="submit"].button_update, input[type="button"].button_update');

        // make buttons into jQueryUI buttons
        shp_buttons.button();

        // set default jQuery Themeroller style if disabled
        shp_buttons.each(function () {
            if ($(this).is(':disabled')) {
                $(this).removeClass('blue_gradient').removeClass('button_update').button({ disabled: true });
            }
        });

        $(document).on({
            click: function (e) {
                e.preventDefault();
                location.href = '/handlers/logout.ashx';
            }
        }, '.login_button');

        // skip tab index for links
        $('a').attr('tabindex', -1);

        // loading screen for provider select
        $('.loading_screen').change(function () {
            $('body').append('<div id="loading_screen"></div>').css('background', 'white');
            $('#loading_screen').css('left', $(window).scrollLeft())
                .css('top', $(window).scrollTop());
        });

        $('body').ajaxStart(function() {
            $(this).css({'cursor':'wait'});
        }).ajaxStop(function() {
            $(this).css({'cursor':'default'});
        });

        $("input[type=text]").focus(function() {
            this.select();
        });

        $('#outcomes_submit').on('click', function () {
            $('body').append('<div id="loading_screen"></div>').css('background', 'white');
        });

        $('.disabled_widget').each(function () {
            $(this).disable_widget();
        });

        // fix for ie8 infinite-loop bug
        // source: http://cyanbyfuchsia.wordpress.com
        var currentHeight;
        var currentWidth;

        $(window).resize(function () {
            if ($('html').hasClass('lt-ie9')) {
               var windowHeight = $(window).height();
               var windowWidth = $(window).width();
               if (currentHeight === undefined || currentHeight !== windowHeight || currentWidth === undefined || currentWidth !== windowWidth) {
                  $(document).resize_window();
                  currentHeight = windowHeight;
                  currentWidth = windowWidth;
               }
            } else {
              $(document).resize_window();
            }
        });
    }
});

// after doc ready is complete, execute the below
$(window).load(function () {

    var page_name = location.pathname.substring(1).toLowerCase();

    // disable dashboard for lt-ie8 users
    if (page_name === 'dashboard.aspx' && $('html').hasClass('lt-ie8')) {
        $('form#form1').hide();
        $('html').css('padding', '50px');
    } else {
        $('#accordion').removeClass('hidden');

        // change page title to active tab if at dashboard
        if (page_name === 'dashboard.aspx') {
            window.document.title = 'SHPSolutionsâ„¢ Dashboard';

            $.make_charts();
            $('#tabs').tabs('option', 'selected', 1);
            $('#loading_screen').remove();
        } else {
            $(document).deflate_ghost_cells({
                page: [
                    { target: '#hospice_symptom_assessments', pathname: '/Hospice/LengthOfService/LengthOfService.aspx' },
                    { target: '#divResults', pathname: '/agencies/outcomes/' }
                ]}
            );
        }
    }
	
    $('body').show();
    $(document).resize_window();
    $('input.first').focus();
});

